<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visualisation - DV</title>
    <link rel="stylesheet" href="/static/CSS/all.css">
    <link rel="stylesheet" href="/static/CSS/charts.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-area">
                <span class="logo-circle"></span>
                <span class="logo-text">Data Visualisation - DV</span>
            </div>
            <button class="menu-button">â˜°</button>
        </header>
        <div class="side-menu" id="sideMenu">
            <button class="close-button">X</button>
            <h1>What would you like to See?</h1>
            <a href="/charts">Chart Overview</a>
            <a href="#">Edit/Clear Data</a>
            <a href="#">Forecast</a>
            <a href="#">My Profile</a>
            <a href="/login">Sign In</a>
            <a href="/">Log Out</a>
        </div>
        <main class="main">
            <section class="data-selection">
                <h2>Please Choose your Data</h2>
                <form id="dataForm">
                    <label for="xAxis">X-Axis</label>
                    <select id="xAxis" name="xAxis">
                        <option value="None">None</option>
                        <optgroup label="Orders">
                            <option value="orders.OrderID">OrderID</option>
                            <option value="orders.CustomerID">CustomerID</option>
                            <option value="orders.StoreID">StoreID</option>
                            <option value="orders.OrderDate">Order Date</option>
                            <option value="orders.nItems">Number of Items</option>
                            <option value="orders.total">Total</option>
                        </optgroup>
                        <optgroup label="Customers">
                            <option value="customers.CustomerID">CustomerID</option>
                            <option value="customers.Latitude">Latitude</option>
                            <option value="customers.Longitude">Longitude</option>
                        </optgroup>
                        <optgroup label="Order Items">
                            <option value="orderItems.SKU">SKU</option>
                            <option value="orderItems.OrderID">OrderID</option>
                        </optgroup>
                        <optgroup label="Products">
                            <option value="products.SKU">SKU</option>
                            <option value="products.Name">Name</option>
                            <option value="products.Price">Price</option>
                            <option value="products.Category">Category</option>
                            <option value="products.Size">Size</option>
                            <option value="products.Ingredients">Ingredients</option>
                            <option value="products.Launch">Launch</option>
                        </optgroup>
                        <optgroup label="Stores">
                            <option value="stores.StoreID">StoreID</option>
                            <option value="stores.Zipcode">Zipcode</option>
                            <option value="stores.StateShort">StateShort</option>
                            <option value="stores.Latitude">Latitude</option>
                            <option value="stores.Longitude">Longitude</option>
                        </optgroup>
                    </select>

                    <label for="yAxis">Y-Axis</label>
                    <select id="yAxis" name="yAxis">
                        <option value="None">None</option>
                        <optgroup label="Orders">
                            <option value="orders.OrderID">OrderID</option>
                            <option value="orders.CustomerID">CustomerID</option>
                            <option value="orders.StoreID">StoreID</option>
                            <option value="orders.OrderDate">Order Date</option>
                            <option value="orders.nItems">Number of Items</option>
                            <option value="orders.total">Total</option>
                        </optgroup>
                        <optgroup label="Customers">
                            <option value="customers.CustomerID">CustomerID</option>
                            <option value="customers.Latitude">Latitude</option>
                            <option value="customers.Longitude">Longitude</option>
                        </optgroup>
                        <optgroup label="Order Items">
                            <option value="orderItems.SKU">SKU</option>
                            <option value="orderItems.OrderID">OrderID</option>
                        </optgroup>
                        <optgroup label="Products">
                            <option value="products.SKU">SKU</option>
                            <option value="products.Name">Name</option>
                            <option value="products.Price">Price</option>
                            <option value="products.Category">Category</option>
                            <option value="products.Size">Size</option>
                            <option value="products.Ingredients">Ingredients</option>
                            <option value="products.Launch">Launch</option>
                        </optgroup>
                        <optgroup label="Stores">
                            <option value="stores.StoreID">StoreID</option>
                            <option value="stores.Zipcode">Zipcode</option>
                            <option value="stores.StateShort">StateShort</option>
                            <option value="stores.Latitude">Latitude</option>
                            <option value="stores.Longitude">Longitude</option>
                        </optgroup>
                    </select>

                    <button type="submit">Submit</button>
                </form>
            </section>
            <section id="chart"></section>
        </main>
        <div id="loading">
            <div class="spinner"></div>
            <p>Please hold on: Your Data is being extracted from the Database.</p>
            <p id="progress">Loading: 0%</p>
        </div>
    </div>
    <script src="/static/JS/sidemenu.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script>
        document.getElementById('dataForm').addEventListener('submit', function (event) {
            event.preventDefault();
            document.getElementById('loading').style.display = 'block';
        
            const formData = new FormData(event.target);
            const data = {
                xAxis: formData.get('xAxis'),
                yAxis: formData.get('yAxis')
            };

            console.log('Sending data to server:', data);
        
            fetch('/get_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(result => {
                document.getElementById('loading').style.display = 'none';
                if (result.error) {
                    console.error(result.error);
                    alert(result.error);
                    return;
                }

                const chartDom = document.getElementById('chart');
                const myChart = echarts.init(chartDom);
        
                const xAxisData = [];
                const yAxisData = [];
                
                result.forEach(item => {
                    xAxisData.push(item.xValue);
                    yAxisData.push(item.yValue);
                });

                console.log('xAxisData:', xAxisData);
                console.log('yAxisData:', yAxisData);
        
                const option = {
                    title: {
                        text: 'Dynamic Bar Chart'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    xAxis: {
                        type: 'category',
                        data: xAxisData
                    },
                    yAxis: {
                        type: 'value',
                        min: 0,
                        max: Math.max(...yAxisData)
                    },
                    series: [{
                        name: 'Data',
                        type: 'bar',
                        data: yAxisData
                    }]
                };
        
                option && myChart.setOption(option);
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                console.error('Error loading data:', error);
                alert('Error loading data: ' + error.message);
            });
        });
    </script>
</body>
</html>
